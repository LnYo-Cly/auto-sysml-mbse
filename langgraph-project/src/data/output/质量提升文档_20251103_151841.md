# 车载空调系统设计文档

## 1. 需求规格 (Requirements)

### 1.1 功能性需求 (Functional)

#### REQ-FUN-001: 空调系统控制
*   **背景与上下文**: 车载空调系统是现代汽车的重要组成部分，用于调节车内温度和湿度，提供舒适的乘坐环境。
*   **详细描述**: 系统应能够根据用户设定和外部环境自动调节车内温度，包括制冷、制热和除湿功能，并通过CAN总线与车辆其他系统（如导航、娱乐系统）进行数据交换。
*   **技术参数和规格**:
    - 制冷量：≥ 2.5 kW
    - 制热量：≥ 2.0 kW
    - 除湿量：≥ 1.5 kg/h
    - 温度控制精度：±1°C
*   **理由 (Rationale)**: 提高乘客舒适度，减少驾驶员分心，确保行车安全。
*   **验证方法 (Verification)**: 测试、演示
*   **优先级 (Priority)**: High

#### REQ-FUN-002: 温度控制精度
*   **背景与上下文**: 精确的温度控制对于乘客的舒适度至关重要。
*   **详细描述**: 系统应能够将车内温度控制在设定温度的±0.5°C范围内，并通过PID控制算法实现精确调节。
*   **技术参数和规格**:
    - 控制算法：PID
    - 控制周期：1秒
*   **理由 (Rationale)**: 提高用户满意度，确保系统性能。
*   **验证方法 (Verification)**: 测试
*   **优先级 (Priority)**: High

#### REQ-FUN-003: 能耗管理
*   **背景与上下文**: 能耗管理对于提高燃油效率和减少排放至关重要。
*   **详细描述**: 系统应通过智能算法优化制冷和制热过程，以最小化能耗，并实现节能模式。
*   **技术参数和规格**:
    - 节能模式能耗降低：≥ 20%
*   **理由 (Rationale)**: 降低运营成本，减少环境影响。
*   **验证方法 (Verification)**: 分析、测试
*   **优先级 (Priority)**: Medium

### 1.2 非功能性需求 (Non-Functional)

#### REQ-NFN-001: 响应时间
*   **背景与上下文**: 快速响应对于乘客舒适度和系统效率至关重要。
*   **详细描述**: 系统在接收到温度调整指令后，应在2秒内开始响应，并通过实时监控确保系统响应时间不超过3秒。
*   **技术参数和规格**:
    - 响应时间：≤ 2秒
*   **理由 (Rationale)**: 提高用户体验，确保系统效率。
*   **验证方法 (Verification)**: 测试
*   **优先级 (Priority)**: High

#### REQ-NFN-002: 系统可靠性
*   **背景与上下文**: 空调系统需要长时间稳定运行，确保行车安全。
*   **详细描述**: 系统的平均无故障时间（MTBF）应大于10,000小时，并通过冗余设计提高系统的可靠性。
*   **技术参数和规格**:
    - MTBF：≥ 10,000小时
*   **理由 (Rationale)**: 提高系统可用性，减少维护成本。
*   **验证方法 (Verification)**: 分析、测试
*   **优先级 (Priority)**: High

## 2. 系统结构 (Block Definition & Internal Block)

### 2.1 系统顶层架构设计理念
系统采用分层架构，分为用户界面层、控制层和执行层。用户界面层负责接收用户输入，控制层负责处理逻辑和决策，执行层负责执行具体的操作，并通过CAN总线实现各层之间的通信。

### 2.2 块定义 (Block Definition)

#### **块名称**: PowerControlModule
*   **概述**: 负责控制空调系统的电源管理，包括启动、关闭和电源分配。
*   **核心职责**:
    - 启动和关闭空调系统
    - 分配电源到各个子系统
    - 监测电源状态
*   **关键属性**:
    - `- batteryLevel: Real [%] {0..100}`
    - `- voltage: Volts`
*   **核心操作**:
    - `- enablePowerDistribution(voltage: Volts): Status`
    - `- disablePowerDistribution(): Status`
    - `- monitorPowerStatus(): PowerStatus`

#### **块名称**: TemperatureControlModule
*   **概述**: 负责根据用户设定和外部环境调节车内温度。
*   **核心职责**:
    - 控制制冷和制热系统
    - 调节风速和风向
    - 监测车内温度
*   **关键属性**:
    - `- targetTemperature: Real [°C] {15..30}`
    - `- currentTemperature: Real [°C] {15..30}`
    - `- fanSpeed: Integer`
*   **核心操作**:
    - `- adjustTemperature(difference: Real [°C]): Status`
    - `- setFanSpeed(speed: Integer): Status`
    - `- monitorTemperature(): Real [°C]`

#### **块名称**: HumidityControlModule
*   **概述**: 负责调节车内湿度，提供舒适的乘坐环境。
*   **核心职责**:
    - 控制除湿系统
    - 监测车内湿度
*   **关键属性**:
    - `- targetHumidity: Real [%] {30..70}`
    - `- currentHumidity: Real [%] {30..70}`
*   **核心操作**:
    - `- adjustHumidity(difference: Real [%]): Status`
    - `- monitorHumidity(): Real [%]`

### 2.3 内部结构与交互原理 (Internal Block Diagram - IBD)

#### **上下文**: PowerControlModule
*   **设计阐述**: PowerControlModule通过CAN总线与TemperatureControlModule和HumidityControlModule通信，控制电源分配。
*   **组成部分**:
    - PowerControlModule
    - TemperatureControlModule
    - HumidityControlModule
*   **连接关系**:
    - `[PowerControlModule.portA] <--> [TemperatureControlModule.portB]`
    - `[PowerControlModule.portC] <--> [HumidityControlModule.portD]`

## 3. 活动流程 (Activity)

### 3.1 系统启动自检流程
*   **流程概述**: 此流程描述了用户从按下开机按钮到系统进入待机状态的完整自检和初始化序列，确保所有硬件模块正常工作。
*   **输入/输出**:
    - IN: boot_command: Command
    - OUT: system_status: StatusReport
*   **步骤序列**:
    1. 接收开机指令
    2. 检查电源状态
    3. 检查传感器状态
    4. 检查执行器状态
    5. 初始化控制模块
    6. 返回系统状态
    7. 进入待机状态

## 4. 状态机行为 (State Machine)

### 4.1 空调系统状态机
*   **上下文块**: AirConditioningSystem
*   **行为模型概述**: 空调系统的行为模型定义了从‘关闭’到‘待机’再到‘运行’的完整生命周期，包括各种状态和转换条件。
*   **状态定义**:
    - **状态名称**: Off
        *   **描述**: 空调系统关闭状态
        *   `entry`: 关闭所有执行器
        *   `do`: 无操作
        *   `exit`: 无操作
    - **状态名称**: Standby
        *   **描述**: 空调系统待机状态
        *   `entry`: 初始化传感器和执行器
        *   `do`: 监测环境参数
        *   `exit`: 无操作
    - **状态名称**: Running
        *   **描述**: 空调系统运行状态
        *   `entry`: 启动制冷或制热系统
        *   `do`: 调节温度和湿度
        *   `exit`: 关闭制冷或制热系统
*   **转换**:
    - `Off --[power_on]--> Standby`
    - `Standby --[temperature_change] / [humidity_change]--> Running`
    - `Running --[power_off]--> Off`

## 5. 用例场景 (Use Case)

### 5.1 用户控制空调系统
*   **用例名称**: ControlAirConditioning
*   **场景简述**: 用户通过车载触摸屏或物理按钮控制空调系统。
*   **参与者**:
    - Primary: 驾驶员
    - Secondary: 车载触摸屏
*   **基本流程**:
    1. 驾驶员打开车载触摸屏
    2. 驾驶员选择空调系统
    3. 驾驶员设置目标温度和湿度
    4. 系统开始调节温度和湿度
    5. 系统显示当前温度和湿度
    6. 驾驶员调整设置或关闭系统

## 6. 参数关系 (Parametric)

### 6.1 温度控制方程
*   **约束块**: TemperatureControlEquation
*   **物理意义与应用**: 此方程用于计算空调系统达到目标温度所需的时间。
*   **参数**:
    - `T_current`: 当前温度 [°C]
    - `T_target`: 目标温度 [°C]
    - `Q`: 制冷或制热量 [W]
    - `t`: 时间 [s]
*   **约束公式**:
    - `T_current + (Q * t) = T_target`

## 7. 交互序列 (Sequence)

### 7.1 用户设置温度
*   **场景名称**: UserSetsTemperature
*   **交互背景**: 用户通过车载触摸屏设置目标温度。
*   **涉及的生命线**:
    - `[User]`
    - `[TouchScreen]`
    - `[AirConditioningSystem]`
*   **消息序列**:
    1. 用户在触摸屏上设置目标温度
    2. 触摸屏发送温度设置到AirConditioningSystem
    3. AirConditioningSystem调整制冷或制热系统以匹配目标温度
    4. AirConditioningSystem向触摸屏发送当前温度和湿度信息
    5. 触摸屏显示当前温度和湿度信息